/**
 * Uploady v1.0
 * 
 * File upload manager in pure Javascript
 * Find docs on https://github.com/Choko256/uploady
 * 
 * MIT License
 */var Uploady=function(e){var t=function(e,t,n){this.id=e,this.file=t,this.fileField=n,this.fileName=function(){return this.file.name}};typeof e!="object"&&(e={}),this.onProgress=e.onProgress,this.onSuccess=e.onSuccess,this.onError=e.onError,this.onStarted=e.onStarted,this.onFinished=e.onFinished,this.fileField=e.fileField?e.fileField:"upfile",this.appendData=e.appendData?e.appendData:{},this.requestHeaders=e.requestHeaders?e.requestHeaders:{},this.targetUrl=e.targetUrl,this.singleRequest=e.singleRequest?e.singleRequest:!1;var n=[],r=0;this.addFile=function(e,i,s){var o=new t(r,e);s&&(o.fileField=s);for(var u in i)o[u]=i[u];return n.push(o),r++,o},this.addFiles=function(e,t){for(var n in e)this.addFile(e[n],t,n)},this.removeFile=function(e){for(var t=0;t<n.length;t++)if(n[t].id==e)return n.splice(t,1);return null},this.finish=function(e,t,n){this.onFinished&&this.onFinished({total:n,succeed:e,failed:t})},this.setSingleRequest=function(e){this.singleRequest=e};var i=function(){var e=this,t=new XMLHttpRequest,r=new FormData;this.onStarted&&this.onStarted(null,t),t.upload.items=[];for(var i in this.requestHeaders)t.setRequestHeader(i,this.requestHeaders[i]);for(var s=0;s<n.length;s++)t.upload.items.push(n[s]),r.append(n[s].fileField?n[s].fileField:e.fileField+s,n[s].file);for(var i in this.appendData)r.append(i,this.appendData[i]);t.upload.addEventListener("progress",function(t){t.lengthComputable?e.onProgress&&e.onProgress(null,t.loaded,t.total):e.onProgress&&e.onProgress(null)}),t.addEventListener("readystatechange",function(t){this.readyState===4&&(this.status!==200?(this.abort(),e.onError&&e.onError({status:this.status,file:null})):e.onSuccess&&e.onSuccess({response:this.responseText,file:null}),e.finish())}),t.upload.addEventListener("error",function(t){e.onError&&e.onError({status:t.target.status,file:null}),e.finish()}),t.open("post",e.targetUrl,!0),t.send(r)},s=function(){var e=0,t=0,r=0,i=this;for(var s=0;s<n.length;s++){var o=n[s],u=new XMLHttpRequest;this.onStarted&&this.onStarted(o,u),u.upload.item=o;for(var a in this.requestHeaders)u.setRequestHeader(a,this.requestHeaders[a]);var f=new FormData;f.append(this.fileField,o.file);for(var a in this.appendData)f.append(a,this.appendData[a]);u.upload.addEventListener("progress",function(e){e.lengthComputable?i.onProgress&&i.onProgress(this.item,e.loaded,e.total):i.onProgress&&i.onProgress(this.item)}),u.addEventListener("readystatechange",function(s){this.readyState===4&&(this.status!==200?(this.abort(),t++,i.onError&&i.onError({status:this.status,file:this.upload.item.file})):(e++,i.onSuccess&&i.onSuccess({file:this.upload.item.file,response:this.responseText})),r++,r==n.length&&i.finish())}),u.upload.addEventListener("error",function(e){t++,r++,i.onError&&i.onError({status:e.target.status,file:this.item.file}),r==n.length&&i.finish()}),u.open("post",i.targetUrl,!0),u.send(f)}};this.upload=function(){this.singleRequest?i():s()},this.clear=function(){n=[]}};