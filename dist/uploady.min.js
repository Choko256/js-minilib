"use strict";var Uploady=function(e){var t=this,n=function(e,t,n){this.id=e,this.file=t,this.fileField=n,this.fileName=function(){return this.file.name}};typeof e!="object"&&(e={}),t.onProgress=e.onProgress,t.onSuccess=e.onSuccess,t.onError=e.onError,t.onStarted=e.onStarted,t.onFinished=e.onFinished,t.fileField=e.fileField?e.fileField:"upfile",t.appendData=e.appendData?e.appendData:{},t.requestHeaders=e.requestHeaders?e.requestHeaders:{},t.targetUrl=e.targetUrl,t.singleRequest=e.singleRequest?e.singleRequest:!1;var r=[],i=0;t.addFile=function(e,t,s){var o=new n(i,e);s&&(o.fileField=s);for(var u in t)o[u]=t[u];return r.push(o),i++,o},t.addFiles=function(e,n){for(var r in e)t.addFile(e[r],n,r)},t.removeFile=function(e){for(var t=0;t<r.length;t++)if(r[t].id==e)return r.splice(t,1);return null},t.finish=function(e,n,r){t.onFinished&&t.onFinished({total:r,succeed:e,failed:n})},t.setSingleRequest=function(e){t.singleRequest=e};var s=function(){var e=new XMLHttpRequest,n=new FormData;t.onStarted&&t.onStarted(null,e),e.upload.items=[];for(var i in t.requestHeaders)e.setRequestHeader(i,t.requestHeaders[i]);for(var s=0;s<r.length;s++)e.upload.items.push(r[s]),n.append(r[s].fileField?r[s].fileField:t.fileField+s,r[s].file);for(var i in t.appendData)n.append(i,t.appendData[i]);e.upload.addEventListener("progress",function(e){e.lengthComputable?t.onProgress&&t.onProgress(null,e.loaded,e.total):t.onProgress&&t.onProgress(null)}),e.addEventListener("readystatechange",function(e){this.readyState===4&&(this.status!==200?(this.abort(),t.onError&&t.onError({status:this.status,file:null})):t.onSuccess&&t.onSuccess({response:this.responseText,file:null}),t.finish())}),e.upload.addEventListener("error",function(e){t.onError&&t.onError({status:e.target.status,file:null}),t.finish()}),e.open("post",t.targetUrl,!0),e.send(n)},o=function(){var e=0,n=0,i=0;for(var s=0;s<r.length;s++){var o=r[s],u=new XMLHttpRequest;t.onStarted&&t.onStarted(o,u),u.upload.item=o;for(var a in t.requestHeaders)u.setRequestHeader(a,t.requestHeaders[a]);var f=new FormData;f.append(t.fileField,o.file);for(var a in t.appendData)f.append(a,t.appendData[a]);u.upload.addEventListener("progress",function(e){e.lengthComputable?t.onProgress&&t.onProgress(this.item,e.loaded,e.total):t.onProgress&&t.onProgress(this.item)}),u.addEventListener("readystatechange",function(s){this.readyState===4&&(this.status!==200?(this.abort(),n++,t.onError&&t.onError({status:this.status,file:this.upload.item.file})):(e++,t.onSuccess&&t.onSuccess({file:this.upload.item.file,response:this.responseText})),i++,i==r.length&&t.finish())}),u.upload.addEventListener("error",function(e){n++,i++,t.onError&&t.onError({status:e.target.status,file:this.item.file}),i==r.length&&t.finish()}),u.open("post",t.targetUrl,!0),u.send(f)}};t.upload=function(){t.singleRequest?s():o()},t.clear=function(){r=[]}};